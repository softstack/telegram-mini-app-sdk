{"version":3,"file":"validation.js","sourceRoot":"","sources":["../../src/validation.ts"],"names":[],"mappings":"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","sourcesContent":["import { validateSchema, validateType } from '@tconnect.io/core';\nimport { TezosBeaconErrorResponse, TezosBeaconEvent, TezosBeaconResponse } from '@tconnect.io/tezos-beacon-api-types';\nimport Joi from 'joi';\nimport {\n\tBaseMessage,\n\tDisconnectMessage,\n\tErrorResponse,\n\tOperationResponse,\n\tPeerInfo,\n\tPermissionResponse,\n\tSignPayloadResponse,\n} from './types';\n\nexport const validateTezosBeaconResponse = (\n\tvalue: TezosBeaconResponse | TezosBeaconErrorResponse,\n): TezosBeaconResponse | TezosBeaconErrorResponse =>\n\tvalidateSchema(\n\t\tvalue,\n\t\tJoi.alternatives()\n\t\t\t.try(\n\t\t\t\tJoi.object({\n\t\t\t\t\ttype: Joi.string().valid('error').required(),\n\t\t\t\t\tpayload: Joi.alternatives(\n\t\t\t\t\t\tJoi.object({\n\t\t\t\t\t\t\ttype: Joi.string().valid('generic').required(),\n\t\t\t\t\t\t\tkey: Joi.string().required(),\n\t\t\t\t\t\t\tmessage: Joi.string(),\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tJoi.object({\n\t\t\t\t\t\t\ttype: Joi.string().valid('invalidSessionId', 'invalidApiKey').required(),\n\t\t\t\t\t\t\tmessage: Joi.string(),\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t}),\n\t\t\t\tJoi.object({\n\t\t\t\t\ttype: Joi.string().valid('init').required(),\n\t\t\t\t\tpayload: Joi.object({\n\t\t\t\t\t\tsessionId: Joi.string().required(),\n\t\t\t\t\t\tloginRawDigest: Joi.string().hex().required(),\n\t\t\t\t\t}),\n\t\t\t\t}),\n\t\t\t\tJoi.object({\n\t\t\t\t\ttype: Joi.string().valid('login').required(),\n\t\t\t\t\tpayload: Joi.object({\n\t\t\t\t\t\tconnectionString: Joi.string().required(),\n\t\t\t\t\t}),\n\t\t\t\t}),\n\t\t\t\tJoi.object({\n\t\t\t\t\ttype: Joi.string().valid('message').required(),\n\t\t\t\t}),\n\t\t\t\tJoi.object({\n\t\t\t\t\ttype: Joi.string().valid('reconnect').required(),\n\t\t\t\t}),\n\t\t\t\tJoi.object({\n\t\t\t\t\ttype: Joi.string().valid('disconnect').required(),\n\t\t\t\t}),\n\t\t\t)\n\t\t\t.required(),\n\t);\n\nexport const validateTezosBeaconEvent = (value: TezosBeaconEvent): TezosBeaconEvent =>\n\tvalidateSchema(\n\t\tvalue,\n\t\tJoi.alternatives().try(\n\t\t\tJoi.object({\n\t\t\t\ttype: Joi.string().valid('message').required(),\n\t\t\t\tpayload: Joi.object({\n\t\t\t\t\tmessage: Joi.string().required(),\n\t\t\t\t}),\n\t\t\t}),\n\t\t\tJoi.object({\n\t\t\t\ttype: Joi.string().valid('disconnect').required(),\n\t\t\t}),\n\t\t),\n\t);\n\nexport const isPeerInfo = (value: unknown): value is PeerInfo =>\n\tvalidateType(\n\t\tvalue,\n\t\tJoi.object({\n\t\t\ttype: Joi.string().valid('p2p-pairing-response').required(),\n\t\t\tid: Joi.string().required(),\n\t\t\tname: Joi.string().required(),\n\t\t\tversion: Joi.string().required(),\n\t\t\tpublicKey: Joi.string().required(),\n\t\t\trelayServer: Joi.string().required(),\n\t\t\tappUrl: Joi.string(),\n\t\t\ticon: Joi.string(),\n\t\t}),\n\t);\n\nexport const isBaseMessage = (value: unknown): value is BaseMessage =>\n\tvalidateType(\n\t\tvalue,\n\t\tJoi.object({\n\t\t\ttype: Joi.string()\n\t\t\t\t.valid(\n\t\t\t\t\t'permission_request',\n\t\t\t\t\t'sign_payload_request',\n\t\t\t\t\t'operation_request',\n\t\t\t\t\t'broadcast_request',\n\t\t\t\t\t'permission_response',\n\t\t\t\t\t'sign_payload_response',\n\t\t\t\t\t'operation_response',\n\t\t\t\t\t'broadcast_response',\n\t\t\t\t\t'disconnect',\n\t\t\t\t\t'error',\n\t\t\t\t\t'acknowledge',\n\t\t\t\t)\n\t\t\t\t.required(),\n\t\t\tversion: Joi.string().required(),\n\t\t\tid: Joi.string().required(),\n\t\t\tsenderId: Joi.string().required(),\n\t\t}).options({ allowUnknown: true }),\n\t);\n\nexport const isPermissionResponse = (value: unknown): value is PermissionResponse =>\n\tvalidateType(\n\t\tvalue,\n\t\tJoi.object({\n\t\t\ttype: Joi.string().valid('permission_response').required(),\n\t\t\tversion: Joi.string().required(),\n\t\t\tid: Joi.string().required(),\n\t\t\tsenderId: Joi.string().required(),\n\t\t\tpublicKey: Joi.string().required(),\n\t\t\tnetwork: Joi.object({\n\t\t\t\ttype: Joi.string().valid('mainnet', 'carthagenet', 'custom', 'ghostnet').required(),\n\t\t\t\tname: Joi.string(),\n\t\t\t\trpcUrl: Joi.string(),\n\t\t\t}).required(),\n\t\t\tscopes: Joi.array()\n\t\t\t\t.items(Joi.string().valid('sign', 'operation_request', 'threshold'))\n\t\t\t\t.required(),\n\t\t\tthreshold: Joi.object({\n\t\t\t\tamount: Joi.string().required(),\n\t\t\t\ttimeframe: Joi.string().required(),\n\t\t\t}),\n\t\t\tappMetadata: Joi.object({\n\t\t\t\tsenderId: Joi.string().required(),\n\t\t\t\tname: Joi.string().required(),\n\t\t\t\ticon: Joi.string(),\n\t\t\t}),\n\t\t}),\n\t);\n\nexport const isOperationResponse = (value: unknown): value is OperationResponse =>\n\tvalidateType(\n\t\tvalue,\n\t\tJoi.object({\n\t\t\ttype: Joi.string().valid('operation_response').required(),\n\t\t\tversion: Joi.string().required(),\n\t\t\tid: Joi.string().required(),\n\t\t\tsenderId: Joi.string().required(),\n\t\t\ttransactionHash: Joi.string().required(),\n\t\t}),\n\t);\n\nexport const isSignPayloadResponse = (value: unknown): value is SignPayloadResponse =>\n\tvalidateType(\n\t\tvalue,\n\t\tJoi.object({\n\t\t\ttype: Joi.string().valid('sign_payload_response').required(),\n\t\t\tversion: Joi.string().required(),\n\t\t\tid: Joi.string().required(),\n\t\t\tsenderId: Joi.string().required(),\n\t\t\tsignature: Joi.string().required(),\n\t\t\tsigningType: Joi.string(), // 'raw'\n\t\t}),\n\t);\n\nexport const isDisconnectMessage = (value: unknown): value is DisconnectMessage =>\n\tvalidateType(\n\t\tvalue,\n\t\tJoi.object({\n\t\t\ttype: Joi.string().valid('disconnect').required(),\n\t\t\tversion: Joi.string().required(),\n\t\t\tid: Joi.string().required(),\n\t\t\tsenderId: Joi.string().required(),\n\t\t}),\n\t);\n\nexport const isErrorResponse = (value: unknown): value is ErrorResponse =>\n\tvalidateType(\n\t\tvalue,\n\t\tJoi.object({\n\t\t\ttype: Joi.string().valid('error').required(),\n\t\t\tversion: Joi.string().required(),\n\t\t\tid: Joi.string().required(),\n\t\t\tsenderId: Joi.string().required(),\n\t\t\terrorType: Joi.string()\n\t\t\t\t.valid(\n\t\t\t\t\t'BROADCAST_ERROR',\n\t\t\t\t\t'NETWORK_NOT_SUPPORTED',\n\t\t\t\t\t'NO_ADDRESS_ERROR',\n\t\t\t\t\t'NO_PRIVATE_KEY_FOUND_ERROR',\n\t\t\t\t\t'NOT_GRANTED_ERROR',\n\t\t\t\t\t'PARAMETERS_INVALID_ERROR',\n\t\t\t\t\t'TOO_MANY_OPERATIONS',\n\t\t\t\t\t'TRANSACTION_INVALID_ERROR',\n\t\t\t\t\t'ABORTED_ERROR',\n\t\t\t\t\t'UNKNOWN_ERROR',\n\t\t\t\t)\n\t\t\t\t.required(),\n\t\t}),\n\t);\n"]}